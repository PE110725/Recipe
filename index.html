<!DOCTYPE html>
<html>
<head>
  <title>Product Entry Form</title>
  <style>
    body { font-family: Arial; max-width: 500px; margin: auto; }
    input, textarea, select { width: 100%; margin: 8px 0; padding: 8px; text-transform: uppercase; }
    .itemRow { display: flex; gap: 10px; margin-bottom: 8px; }
    .itemRow input { flex: 1; }
    .itemRow .percentage { width: 70px; background: #eee; border: 1px solid #ccc; padding: 8px; text-align: right; }
    button { padding: 10px 15px; }
  </style>
</head>
<body>

  <h2>Product Entry Form</h2>
  <form id="productForm">
    <select name="polymer" id="polymerSelect" required>
      <option value="">-- Select Polymer --</option>
    </select>

    <input name="product" placeholder="Product Name" required>

    <div id="items">
      <div class="itemRow">
        <input name="item" placeholder="Item" required>
        <input name="weight" type="number" step="0.001" placeholder="Weight" required>
        <div class="percentage">0%</div>
      </div>
    </div>

    <button type="button" id="addItemBtn">+ Add More Items</button><br><br>

    <input name="pantone" placeholder="Pantone">
    <input name="ral" placeholder="RAL">
    <input name="application" placeholder="Application">
    <textarea name="additional" placeholder="Additional Information"></textarea>

    <button type="submit">Submit</button>
  </form>

  <script>
    const polymers = [
      "PE", "PVC", "EVA", "ABS", "SAN", "GPPS", "NYLON", "PET", "PC", "PTFE",
      "R-PE", "R-LD", "R-LLD", "R-PPCP", "R-PVC", "R-EVA", "R-ABS", "R-SAN", "R-GGPS", "R-PET", "R-NYLON"
    ];

    // Populate searchable dropdown
    document.addEventListener("DOMContentLoaded", () => {
      const polymerSelect = document.getElementById('polymerSelect');
      polymers.forEach(polymer => {
        const option = document.createElement('option');
        option.value = polymer;
        option.textContent = polymer;
        polymerSelect.appendChild(option);
      });

      // Enable search using datalist
      polymerSelect.addEventListener('change', () => polymerSelect.blur());

      // Add item row
      document.getElementById("addItemBtn").addEventListener("click", function () {
        const div = document.createElement('div');
        div.className = 'itemRow';
        div.innerHTML = `
          <input name="item" placeholder="Item" required>
          <input name="weight" type="number" step="0.001" placeholder="Weight" required>
          <div class="percentage">0%</div>
        `;
        document.getElementById('items').appendChild(div);
      });

      // Weight input listener for percentage calculation
      document.getElementById("productForm").addEventListener("input", () => {
        const weights = Array.from(document.getElementsByName('weight')).map(w => parseFloat(w.value) || 0);
        const total = weights.reduce((a, b) => a + b, 0);
        const percents = document.querySelectorAll(".percentage");

        weights.forEach((w, i) => {
          percents[i].textContent = total > 0 ? ((w / total) * 100).toFixed(1) + "%" : "0%";
        });
      });

      // Form submission
      document.getElementById('productForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);

        const toUpper = str => (str || "").toUpperCase();

        const polymer = toUpper(formData.get('polymer'));
        const product = toUpper(formData.get('product'));
        const pantone = toUpper(formData.get('pantone'));
        const ral = toUpper(formData.get('ral'));
        const application = toUpper(formData.get('application'));
        const additional = toUpper(formData.get('additional'));

        const items = Array.from(document.getElementsByName('item')).map(input => input.value.toUpperCase());
        const weights = Array.from(document.getElementsByName('weight')).map(input => parseFloat(input.value) || 0);

        const data = new FormData();
        data.append('polymer', polymer);
        data.append('product', product);
        data.append('items', JSON.stringify(items));
        data.append('weights', JSON.stringify(weights));
        data.append('pantone', pantone);
        data.append('ral', ral);
        data.append('application', application);
        data.append('additional', additional);

        const scriptURL = 'https://script.google.com/macros/s/AKfycbxQlJS3q-geMyW5Ldh7Fwo9BXD21_2BGuCZlE0Y5yd51bf0kfdMUPYSS0s90SRFEEJD/exec';

        fetch(scriptURL, { method: 'POST', body: data })
          .then(response => alert("Submitted Successfully!"))
          .catch(error => alert("Error: " + error.message));
      });
    });
  </script>

</body>
</html>
